

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap & DataTables -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css">

  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      margin-top: 40px;
    }
    .table img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 5px;
      cursor: pointer;
    }
    .toggle-buttons {
      margin-bottom: 25px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .export-btns {
      margin-bottom: 15px;
    }
    #employee-section, #attendance-section {
      display: none;
    }
    .modal-img {
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="container bg-white p-4 rounded shadow">
    <h2 class="mb-4 text-center">ðŸ“‹ Admin Dashboard</h2>

    <div class="toggle-buttons">
      <button class="btn btn-outline-primary" onclick="toggleSection('employee')">ðŸ‘¤ Employees</button>
      <button class="btn btn-outline-secondary" onclick="toggleSection('attendance')">ðŸ•’ Attendance</button>
    </div>

    <!-- Employee Section -->
    <div id="employee-section">
      <div class="export-btns text-end">
        <a href="{% url 'export_employees_csv' %}" class="btn btn-sm btn-outline-success">Export CSV</a>
      </div>
      <h5>Employee List</h5>
      <table id="employee-table" class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Image</th><th>ID</th><th>Name</th><th>Email</th><th>Mobile</th><th>Division</th>
          </tr>
        </thead>
        <tbody>
          {% for emp in employees %}
          <tr>
            <td><img src="{{ emp.face_image.url }}" alt="Face" onclick="openModal(this.src)"></td>
            <td>{{ emp.employee_id }}</td>
            <td>{{ emp.employee_name }}</td>
            <td>{{ emp.email }}</td>
            <td>{{ emp.mobile }}</td>
            <td>{{ emp.division }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Attendance Section -->
    <div id="attendance-section">
      <div class="export-btns text-end">
        <a href="{% url 'export_attendance_csv' %}" class="btn btn-sm btn-outline-success">Export CSV</a>
      </div>
      <h5>Attendance Records</h5>
      <table id="attendance-table" class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Employee ID</th><th>Name</th><th>Mark In</th><th>Mark Out</th><th>In Image</th><th>Out Image</th>
          </tr>
        </thead>
        <tbody>
          {% for record in attendance_data %}
          <tr>
            <td>{{ record.employee.employee_id }}</td>
            <td>{{ record.employee.employee_name }}</td>
            <td>{{ record.marked_in|default:"N/A" }}</td>
            <td>{{ record.marked_out|default:"N/A" }}</td>
            <td>
              {% if record.in_image %}
              <img src="{{ record.in_image }}" alt="In" onclick="openModal(this.src)">
              {% else %} N/A {% endif %}
            </td>
            <td>
              {% if record.out_image %}
              <img src="{{ record.out_image }}" alt="Out" onclick="openModal(this.src)">
              {% else %} N/A {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Image Modal -->
  <div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <img id="modalImg" class="modal-img" src="" alt="Image Preview">
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>

  <script>
    $(document).ready(function () {
      $('#employee-table').DataTable();
      $('#attendance-table').DataTable();
      toggleSection('employee');  // Default
    });

    function toggleSection(section) {
      document.getElementById('employee-section').style.display = section === 'employee' ? 'block' : 'none';
      document.getElementById('attendance-section').style.display = section === 'attendance' ? 'block' : 'none';
    }

    function openModal(src) {
      const modal = new bootstrap.Modal(document.getElementById('imageModal'));
      document.getElementById('modalImg').src = src;
      modal.show();
    }
  </script>
</body>
</html>
